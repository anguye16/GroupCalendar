<!-- This page will allow users to login and view other pages that are locked behind a login wall -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" href="webStyles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://fb.me/react-15.0.0.js"></script>
    <script src="https://fb.me/react-dom-15.0.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/reactfire/1.0.0/reactfire.min.js"></script>
    <script type="text/javascript" src="jasmine/lib/jasmine-2.5.2/jasmine.js"></script>
    <script type="text/javascript" src="jasmine/lib/jasmine-2.5.2/jasmine-html.js"></script>
    <script type="text/javascript" src="jasmine/lib/jasmine-2.5.2/boot.js"></script>
    <link rel="stylesheet" type="text/css" href="jasmine/lib/jasmine-2.5.2/jasmine.css">
</head>

<header>
    <a href="index"> <img class="logo" src="grouplogo.png" alt="GroupCalendarLogo" height="200" width="200"></a>
    <ul>
        <li><a href="login">login</a></li>
        <li><a href="signup">sign up</a></li>
        <li><a href="about">about us</a></li>
    </ul>
</header>

<body>
<h1>
    Login
</h1>

<input type="text" id="email" name="email" placeholder="Email" pattern=".+@.+\.com"><br>
<input type="password" id="password" name="password" placeholder="Password" pattern=".+"><br>

<p>
    <select>
        <ul class="tabs">
            <option>Student</option>
            <option>Teacher</option>
        </ul>
    </select>
</p>

<button id="submitButton" class="round">Submit</button>

<p id="incorrect" style="color:red">Incorrect email/password credentials.</p>
<p id="correct" style="color:green">You are now logged in.</p>

<section></section>

<script type="text/babel">
    $('#incorrect').hide();
    $('#correct').hide();
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyC-qT42afFTH5hPZ_v9wvbrV0sLEggRjHc",
        authDomain: "groupcalendar-82b96.firebaseapp.com",
        databaseURL: "https://groupcalendar-82b96.firebaseio.com",
        storageBucket: "groupcalendar-82b96.appspot.com",
        messagingSenderId: "519544706410"
    };
    firebase.initializeApp(config);
    // Firebase scripts
    var accountRef = firebase.database().ref('accounts');
    var loginChecker = false;
    $('#submitButton').click(function() {
        accountRef.orderByChild("Email").on("child_added", function(snapshot){ // Searches through all emails
            if(snapshot.val().Email == $('[name=email]').val()){ // Email is matched
                accountRef.orderByChild("Password").on("child_added", function(snapshot){ // Searches through all passwords
                    if(snapshot.val().Password == $('[name=password]').val()){ // Password is found WITH correct Email
                        $('#incorrect').hide();
                        $('#correct').show();
                        loginChecker = true;
                        console.log("Inside of correct");
                    }
                    else{
                        $('#correct').hide();
                        $('#incorrect').show();
                        loginChecker = false;
                    }
                });
            }
            else{
                $('#correct').hide();
                $('#incorrect').show();
                loginChecker = false;
            }
        });
    });

    describe("login", function(){
        var spyEvent;
        beforeEach(function(){
            document.getElementById("email").value = 'test@site.com';
            document.getElementById("password").value = 'lemon';
            loginChecker = true;
        });
        it("Has correct login credentials", function(){
            document.getElementById("submitButton").click();
            expect(loginChecker).toBe(true);
        });
    });

    describe("login", function(){
        beforeEach(function(){
            document.getElementById("email").value = 'test@site.com';
            document.getElementById("password").value = 'lemonzzzz';
            loginChecker = false;
        });
        it("Has incorrect login credentials", function(){
            document.getElementById("submitButton").click();
            expect(loginChecker).toBe(false);
        });
    });
</script>


</body>
<footer>
    <ul>
        <li><a href="about">about us</a></li>
    </ul>
</footer>
</html>
